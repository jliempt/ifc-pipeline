<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>IfcOpenShell viewer</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/static/main.css"/>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script type="text/javascript">
        var isIE = !!window.MSInputMethodContext;
        if (isIE) {
            document.write('<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"><\/script>');
            document.write('<script type="text/javascript" src="/static/lib/fetch.umd.js"><\/script>');
            document.write('<script type="text/javascript" src="/static/lib/String.startsWith.js"><\/script>');
            document.write('<script type="text/javascript" src="/static/lib/Array.from.js"><\/script>');
            document.write('<script type="text/javascript" src="/static/lib/Object.entries.js"><\/script>');
            document.write('<script type="text/javascript" src="/static/lib/Object.assign.js"><\/script>');
        }
    </script>
    
    {% if postfix %}
    <script type="text/javascript" src="/static/bimsurfer/lib/three.gltf.orbit.draco.min.js"></script>
    {% else %}
    <script type="text/javascript" src="/static/bimsurfer/lib/three.js"></script>
    <script type="text/javascript" src="/static/bimsurfer/lib/OrbitControls.js"></script>
    <script type="text/javascript" src="/static/bimsurfer/lib/GLTFLoader.js"></script>
    <script type="text/javascript" src="/static/bimsurfer/lib/DRACOLoader.js"></script>
    {% endif %}
    <script type="text/javascript" src="/static/bimsurfer/lib/svg-pan-zoom.js"></script>
    
    <script type="text/javascript">window.MODEL_ID = "{{ id }}"; window.SPINNER_CLASS = 'spinner'; window.NUM_FILES = {{ n_files or 0 }};</script>
    <script type="text/javascript" src="/static/bimsurfer/lib/require.js" data-main="/static/App{{postfix}}.js"></script>
    
</head>
<body>

<div id='left'>
<div id='top' class='bimsurfer-static-tree'></div>
<div id='middle' class='bimsurfer-metadata'></div>
<div id='bottom'></div>
</div>
<div id='right'>
</div>
<div id='footer'>
Powered by <a href='http://ifcopenshell.org/'>IfcOpenShell</a> and <a href='https://github.com/AECgeeks/bimsurfer2'>BIMSurfer2</a> <a href='/log/{{ id }}.html' id='errors'>...</a>
</div>

<script>
fetch('/log/{{ id }}.json').then(function(r) { return r.text(); }).then(function(log) {
    var msgs = log.split("\n").filter(function(s) {
        return s.length;
    }).map(JSON.parse);
    var num_warnings = msgs.filter(function(msg) { return msg.level.toLowerCase() == 'warning'; }).length;
    var num_errors = msgs.filter(function(msg) { return msg.level.toLowerCase() == 'error'; }).length;
    
    document.getElementById('errors').innerHTML = ' <i class="fa fa-exclamation-circle" style="color: #c30"></i> <span>' + num_errors + '</span> <i class="fa fa-exclamation-triangle" style="color: #f96"></i> <span>' + num_warnings + '</span>';
});
</script>

</body>
</html>
